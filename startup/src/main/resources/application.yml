micronaut:
  application:
    name: ddd
  multitenancy:
    tenantresolver:
      principal:
        enabled: true
        claim: tenantId
  security:
    authentication: bearer
    token:
      jwt:
        enable: true
        signatures:
          secret:
            generator:
              secret: ${JWT_GENERATOR_SIGNATURE_SECRET:pleaseChangeThisSecretForANewOne}
    intercept-url-map:
      - pattern: /api/auth/login
        access: isAnonymous()
      - pattern: /api/auth/demo
        access: isAnonymous()
      - pattern: /**
        access: isAuthenticated()
  http:
    services:
      multipart:
        max-file-size: 10MB
        max-request-size: 10MB
resilience4j:
  ratelimiter:
    enabled: true
    instances:
      # 默认限流配置：适用于大部分 API 请求，30 req/s
      default:
        limitForPeriod: 30  # 刷新周期内允许的请求数量
        limitRefreshPeriod: 1s  # 刷新周期，权限在此周期内恢复
        timeoutDuration: 0s  # 等待权限的超时时间，0 表示不等待立即返回
      # 高频限流配置：适用于特殊高并发场景，如秒杀，300 req/s
      high:
        limitForPeriod: 300  # 刷新周期内允许的请求数量
        limitRefreshPeriod: 1s  # 刷新周期
        timeoutDuration: 0s  # 不等待立即返回
      # 敏感操作限流配置：适用于写操作，如创建用户，10 req/s
      sensitive:
        limitForPeriod: 10  # 刷新周期内允许的请求数量
        limitRefreshPeriod: 1s  # 刷新周期
        timeoutDuration: 0s  # 不等待立即返回

auth:
  # JWT 过期时间（毫秒），例如 3600000 是 1 小时
  expire-second: 3600
  # JWT 签名密钥 32位
  secret: "your-super-secret-key-at-least-32-characters-long"
# 自定义限流映射配置
rate-limit:
  mappings:
    # 高频接口，如秒杀
    "/api/seckill/**": "high"
    # 敏感写操作
    "/api/users:post": "sensitive"

datasources:
  default:
    url: ${JDBC_URL:`jdbc:mysql://localhost:3306/ddd_admin?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true`}
    username: ${JDBC_USER:root}
    password: ${JDBC_PASSWORD:123456}
    driver-class-name: com.mysql.cj.jdbc.Driver

# JPA / Hibernate Configuration
jpa:
  default:
    entity-scan:
      packages:
        - "com.mok.common.domain"
        - 'com.mok.sys.domain.model'
    properties:
      hibernate:
        hbm2ddl:
          auto: update
        show_sql: true

# Redis Configuration
redis:
  uri: ${REDIS_URL:`redis://localhost:6379/0`}

# File Storage Configuration
file:
  storage:
    local:
      path: ./uploads
      domain: http://localhost:8080
      prefix: /files
